<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta property="og:title" content="몽록">
  <meta property="og:description" content="매일의 기록이, 결국 꿈이됩니다.">
  <meta property="og:image" content="https://ddokddokmt.github.io/monglog.app/ogimage.png">
  <meta property="og:url" content="https://ddokddokmt.github.io/monglog.app/">

  <title>몽록 설치/열기</title>
  <style>
    @font-face {
      font-family: "maintext";
      src: url("./GabiaCheongyeon.woff2") format("woff2"),
        url("./GabiaCheongyeon.ttf") format("truetype");
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    @font-face {
      font-family: "subtext";
      src: url("./hkyolsb.woff2") format("woff2"),
        url("./hkyolsb.ttf") format("truetype");
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background-color: #FAF7F2;
      font-family: subtext;
      overflow: hidden;
    }

    img {
      display: block;
      max-width: 100%;
      height: auto;
    }

    figure {
      margin: 0;
      width: fit-content;
      height: fit-content;
    }

    .hidden {
      display: none;
    }

    :root {
      --bg: #FAF7F2;
      --text: #444;
      --muted: #7c7c7c;
      --brand: #98507D;
      --radius-xl: 999px;
      --shadow: 4px 4px 10px rgba(0, 0, 0, 0.15);
      --h2-size: clamp(24px, 6vw, 48px);
      --h2-line: 1.28;
      --btn-font: clamp(16px, 4.5vw, 32px);
      --btn-height: clamp(52px, 12vw, 80px);
      --foot-size: clamp(12px, 3.2vw, 16px);
      --wrap-max: 560px;
      --wrap-minpad: 16px;
    }

    #wrap {
      max-width: var(--wrap-max);
      margin: 0 auto;
      padding: 0 var(--wrap-minpad);
      min-height: 100svh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 16px 0;
      display: flex;
      justify-content: center;
    }

    header img {
      max-width: clamp(120px, 40vw, 240px);
      height: auto;
    }

    main {
      flex: 1 0 auto;
      display: flex;
      flex-direction: column;
    }

    .section1 {
      padding: 8px 0 6px;
    }

    .section1 h2 {
      margin: 0;
      font-family: maintext;
      font-weight: 400;
      font-size: var(--h2-size);
      line-height: var(--h2-line);
      text-align: center;
      color: var(--text);
    }

    .section1 h2 span {
      color: var(--brand);
      font-weight: 400;
    }

    .section2 {
      padding: clamp(6px, 2.5vw, 14px) 0;
      display: grid;
      place-items: center;
    }

    .section2 img {
      max-width: min(100%, 420px);
      max-height: min(42vh, 320px);
      object-fit: contain;
    }

    .section3 {
      padding: clamp(8px, 2.5vw, 16px) 0 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .btn {
      width: 70%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      height: var(--btn-height);
      padding: 0 20px;
      background-color: var(--brand);
      color: #fff;
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow);
      cursor: pointer;
      text-decoration: none;
      -webkit-tap-highlight-color: transparent;
      transition: transform 150ms ease, box-shadow 150ms ease, opacity 150ms ease;
      margin: 0 auto;
      flex-shrink: 0;
      border: none;
    }

    .btn:active {
      transform: translateY(1px) scale(0.99);
    }

    @media (hover:hover) {
      .btn:hover {
        opacity: .95;
        box-shadow: 6px 6px 14px rgba(0, 0, 0, .18);
      }
    }

    .btn figure {
      width: clamp(24px, 7vw, 36px);
      height: clamp(24px, 7vw, 36px);
    }

    .btn h2 {
      margin: 0;
      font-family: subtext;
      font-weight: 400;
      font-size: var(--btn-font);
      line-height: 1;
    }

    .btn2 {
      width: 100%;
      margin-top: clamp(12px, 3.5vw, 20px);
      background: transparent;
      border: none;
      color: var(--text);
      font-family: subtext;
      font-size: var(--btn-font);
      text-align: center;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      flex-shrink: 0;
      text-decoration: none;
      display: inline-block;
    }

    .btn2:active {
      opacity: .8;
    }

    footer {
      margin-top: clamp(14px, 4vw, 24px);
      margin-bottom: calc(env(safe-area-inset-bottom, 0) + 16px);
      text-align: center;
      color: var(--muted);
      font-size: var(--foot-size);
      flex: 0 0 auto;
    }
  </style>
</head>

<body>
  <div id="wrap">
    <header>
      <figure><img src="./lofo.png" alt="몽록 MONG.LOG" /></figure>
    </header>
    <main>
      <section class="section1">
        <h2 id="title">매일의 <span>기록이,</span><br />결국 <span>꿈이 됩니다</span></h2>
        <p id="desc" class="hidden" style="text-align:center;color:#444;font-family:subtext;margin-top:8px;"></p>
      </section>
      <section class="section2">
        <figure>
          <img id="thumb" class="hidden" src="" alt="썸네일" />
          <img src="./haemong.png" alt="해몽 일러스트" />
        </figure>
      </section>
      <section class="section3">
        <button id="openBtn" class="btn" aria-label="몽록 앱 설치/열기">
          <figure><img src="./emblem.png" alt="몽록 엠블렘" /></figure>
          <h2>몽록 앱 설치</h2>
        </button>
        <button id="openBtn2" class="btn2" aria-label="몽록 앱 열기">몽록 앱 열기 〉</button>
      </section>
    </main>
    <footer>인앱 브라우저에서는 자동실행이 제한될 수 있습니다.</footer>
  </div>
<script>
  (function () {
    // ====== 설정 ======
    const APP_SCHEME = 'monglog';
    const IOS_APPSTORE = 'https://apps.apple.com/app/id6744044615';
    const ANDROID_PKG = 'com.ddokddok.monglog';
    const ANDROID_PLAY = 'https://play.google.com/store/apps/details?id=com.ddokddok.monglog' + ANDROID_PKG;
    const ANDROID_MARKET = 'market://details?id=' + ANDROID_PKG;

    // 쿼리 파라미터
    const params = new URLSearchParams(location.search);
    const type = params.get('type');        // 'feed' | 'profile'
    const postId = params.get('postId');
    const userId = params.get('userId');

    const btn1 = document.getElementById('openBtn');  // 설치 버튼
    const btn2 = document.getElementById('openBtn2'); // 열기 버튼

    // UA 판별
    const ua = (navigator.userAgent || navigator.vendor || '').toLowerCase();
    const isAndroid = ua.includes('android');
    const isIOS = /iphone|ipad|ipod/.test(ua);
    const isMobile = isAndroid || isIOS;

    // 경로 빌드 (scheme / intent 공용)
    function buildPath() {
      if (type === 'feed' && postId) return 'feed?postId=' + encodeURIComponent(postId);
      if (type === 'profile' && userId) return 'profile?uid=' + encodeURIComponent(userId);
      return 'home';
    }

    function buildSchemeUrl() {
      return APP_SCHEME + '://' + buildPath();
    }

    // Android Chrome 최적: intent:// + fallback_url
    function buildAndroidIntentUrl() {
      // intent://<PATH>#Intent;scheme=<SCHEME>;package=<PKG>;S.browser_fallback_url=<ENCODED_PLAY>;end
      const path = buildPath();
      const fallback = encodeURIComponent(ANDROID_PLAY);
      return `intent://${path}#Intent;scheme=${APP_SCHEME};package=${ANDROID_PKG};S.browser_fallback_url=${fallback};end`;
    }

    function openApp(e) {
      e && e.preventDefault();

      // 데스크톱은 스토어/플레이로만
      if (!isMobile) {
        window.location.href = ANDROID_PLAY; // 웹/데스크톱 방문 시 안내용으로 플레이 링크 노출
        return;
      }

      if (isAndroid) {
        // 1) intent:// 시도 (Chrome/대부분 브라우저에서 앱 실행 또는 플레이스토어 자동 fallback)
        const intentUrl = buildAndroidIntentUrl();
        const start = Date.now();
        window.location.href = intentUrl;

        // 2) 일부 인앱브라우저에서 intent:// 무시될 때 대비 타이머 fallback
        setTimeout(function () {
          // 사용자가 앱으로 전환됐으면 보통 1.5초 내 페이지가 백그라운드됨
          if (Date.now() - start < 1500) {
            // intent://를 못 썼다면 일반 scheme 시도 후 플레이스토어
            const scheme = buildSchemeUrl();
            const t0 = Date.now();
            window.location.href = scheme;
            setTimeout(function () {
              if (Date.now() - t0 < 1500) {
                // market:// 먼저, 실패 시 https:// 플레이
                try { window.location.href = ANDROID_MARKET; } catch (_) { window.location.href = ANDROID_PLAY; }
              }
            }, 900);
          }
        }, 1200);
        return;
      }

      if (isIOS) {
        // iOS는 커스텀 스킴 + 타이머로 App Store fallback
        const scheme = buildSchemeUrl();
        const start = Date.now();
        window.location.href = scheme;
        setTimeout(function () {
          if (Date.now() - start < 1500) {
            window.location.href = IOS_APPSTORE;
          }
        }, 1200);
      }
    }

    btn1.addEventListener('click', openApp);
    btn2.addEventListener('click', openApp);

    // 버튼 라벨도 기기별로 살짝 맞춤 (선택 사항)
    const h2 = btn1.querySelector('h2');
    if (isAndroid) h2.textContent = '몽록 앱 설치 (Android)';
    else if (isIOS) h2.textContent = '몽록 앱 설치 (iOS)';
    else h2.textContent = '몽록 앱 설치';

  })();
</script>

</body>


</html>