<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>앱에서 보기</title>

<!-- (참고) OG 미리보기는 정적 값만 의미 있음. JS로 바꾼 메타는 메신저가 못 읽음 -->
<meta property="og:title" content="몽록">
<meta property="og:description" content="앱에서 열어보세요">
<meta property="og:image" content="https://example.com/default-og.jpg">
<meta property="og:url" content="https://example.com/open.html">

<style>
  :root{
    --bg:#FFF8F0; --brand:#98507D; --text:#222; --muted:#777;
    --card:#fff; --shadow:0 10px 30px rgba(0,0,0,.08);
  }
  html,body{margin:0}
  body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,"Malgun Gothic",sans-serif;
       background:var(--bg); color:var(--text)}
  .wrap{max-width:560px;margin:40px auto;padding:0 20px;text-align:center}
  .thumb{width:100%;max-width:560px;border-radius:16px;box-shadow:var(--shadow);display:none}
  h1{font-size:22px;margin:18px 0 8px}
  p{font-size:15px;color:#555;margin:0 0 18px}
  .btn{display:inline-block;padding:14px 20px;border-radius:12px;background:var(--brand);color:#fff;
       text-decoration:none;font-weight:700}
  .sub{margin-top:12px;font-size:13px;color:var(--muted)}
  .code{font-family:ui-monospace, Menlo, Consolas, monospace; font-size:13px; color:#444; word-break:break-all}
  .hidden{display:none}
  .err{background:#fff;border-radius:12px;padding:16px;box-shadow:var(--shadow);color:#b00020}
</style>
</head>
<body>
  <div class="wrap">
    <img id="thumb" class="thumb" alt="preview" />
    <h1 id="title">앱에서 열기</h1>
    <p id="desc">버튼을 눌러 앱으로 이동하세요.</p>

    <a class="btn" href="#" id="openBtn">앱에서 보기</a>
    <div class="sub">앱이 없다면 자동으로 스토어로 이동합니다.</div>

    <div id="error" class="err hidden" role="alert"></div>
    <div id="debug" class="code hidden"></div>
  </div>

<script>
(function(){
  // ====== 설정 값을 여기에 맞춰 바꾸세요 ======
  const APP_SCHEME = 'monglog'; // ← 네 커스텀 스킴
  const APPSTORE_URL = 'https://apps.apple.com/app/idYOUR_APPSTORE_ID'; // ← 앱스토어 링크
  const DEFAULT_THUMB = ''; // 기본 썸네일(URL 있으면 표시)
  // ============================================

  const $ = (id)=>document.getElementById(id);
  const params = new URLSearchParams(location.search);
  const type    = params.get('type');     // "feed" | "profile"
  const postId  = params.get('postId');   // 숫자 문자열
  const userId  = params.get('userId');   // 숫자 문자열

  // 화면 표시용
  const titleEl = $('title');
  const descEl  = $('desc');
  const thumbEl = $('thumb');
  const errEl   = $('error');
  const dbgEl   = $('debug');
  const btn     = $('openBtn');

  function showError(msg){
    errEl.textContent = msg;
    errEl.classList.remove('hidden');
  }

  function setThumb(url){
    if (!url) return;
    thumbEl.src = url;
    thumbEl.style.display = 'block';
  }

  // 스킴 URL 구성
  function buildScheme(){
    if (type === 'feed' && postId) {
      return `${APP_SCHEME}://feed?postId=${encodeURIComponent(postId)}`;
    }
    if (type === 'profile' && userId) {
      return `${APP_SCHEME}://profile?uid=${encodeURIComponent(userId)}`;
    }
    return null;
  }

  // UI 셋업
  (function initUI(){
    if (type === 'feed' && postId) {
      titleEl.textContent = `피드 #${postId}`;
      descEl.textContent  = '앱에서 이 피드를 열어보세요.';
      setThumb(DEFAULT_THUMB);
    } else if (type === 'profile' && userId) {
      titleEl.textContent = `프로필 #${userId}`;
      descEl.textContent  = '앱에서 이 프로필을 열어보세요.';
      setThumb(DEFAULT_THUMB);
    } else {
      showError('필요한 파라미터가 없습니다. 예: ?type=feed&postId=123 또는 ?type=profile&userId=456');
    }
  })();

  // 앱 열기 (실패 시 앱스토어로)
  function openApp(){
    const scheme = buildScheme();
    if (!scheme) return;
    // 인앱 브라우저/보안정책 때문에 "사용자 클릭"에서 호출해야 열리는 경우가 있어
    const start = Date.now();
    // iOS Safari/대부분 브라우저: location.href
    window.location.href = scheme;
    // 1.2~1.5초 안에 포커스 변동이 없으면 스토어로 폴백
    setTimeout(function(){
      if (Date.now() - start < 1500) {
        window.location.href = APPSTORE_URL;
      }
    }, 1200);
  }

  btn.addEventListener('click', function(e){
    e.preventDefault();
    openApp();
  });

  // 자동 시도(사용자 경험용) – 인앱 브라우저에서 막히면 버튼으로 재시도
  setTimeout(openApp, 400);

  // 디버그(원하면 숨김 해제)
  // dbgEl.classList.remove('hidden');
  // dbgEl.textContent = JSON.stringify(Object.fromEntries(params.entries()), null, 2);

})();
</script>
</body>
</html>
